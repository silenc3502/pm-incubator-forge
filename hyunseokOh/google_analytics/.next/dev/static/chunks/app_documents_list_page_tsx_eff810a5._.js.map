{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/reallies/Documents/GitHub/pm-incubator-forge/hyunseokOh/google_analytics/app/documents/list/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\n\ninterface DocumentMeta {\n    id: number;\n    file_name: string;\n    s3_key: string;\n    uploader_id: number;\n}\n\ninterface AnalyzeResultType {\n    parsed_text: string;\n    summaries: {\n        bullet: string;\n        abstract: string;\n        casual: string;\n        final: string;\n    };\n    answer: string;\n}\n\nexport default function DocumentListPage() {\n    const [documents, setDocuments] = useState<DocumentMeta[]>([]);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(\"\");\n    const [analyzeResults, setAnalyzeResults] = useState<Record<number, AnalyzeResultType>>({});\n    const [analyzingId, setAnalyzingId] = useState<number | null>(null);\n\n    const fetchDocuments = async () => {\n        setLoading(true);\n        setError(\"\");\n        try {\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/documents/list`, {\n                credentials: \"include\",\n            });\n            const data = await res.json();\n            if (!res.ok) throw new Error(data.detail || \"문서 목록 불러오기 실패\");\n            setDocuments(data);\n        } catch (e: any) {\n            setError(e.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleAnalyze = async (doc: DocumentMeta) => {\n        const s3Url = `https://s3-eddi-lsh-bucket.s3.ap-northeast-2.amazonaws.com/${doc.s3_key}`;\n        setAnalyzingId(doc.id);\n        try {\n            const res = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/documents-multi-agents/analyze`, {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({\n                    doc_id: doc.id,\n                    doc_url: s3Url,\n                    question: \"Summarize the content\",\n                }),\n                credentials: \"include\",\n            });\n\n            const data = await res.json();\n            if (!res.ok) throw new Error(data.detail || \"분석 실패\");\n\n            setAnalyzeResults(prev => ({\n                ...prev,\n                [doc.id]: data,\n            }));\n        } catch (e: any) {\n            alert(`분석 실패: ${e.message}`);\n        } finally {\n            setAnalyzingId(null);\n        }\n    };\n\n    useEffect(() => {\n        fetchDocuments();\n    }, []);\n\n    return (\n        <div className=\"min-h-screen bg-gray-100 p-8\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-6 text-center\">문서 리스트</h1>\n\n            <div className=\"text-center mb-6\">\n                <Link\n                    href=\"/documents/register\"\n                    className=\"bg-blue-600 px-4 py-2 rounded text-white hover:bg-blue-700\"\n                >\n                    문서 업로드\n                </Link>\n            </div>\n\n            {loading && <p className=\"text-center text-gray-700\">불러오는 중...</p>}\n            {error && <p className=\"text-center text-red-600 font-medium\">{error}</p>}\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {documents.map((doc) => {\n                    const s3Url = `https://s3-eddi-lsh-bucket.s3.ap-northeast-2.amazonaws.com/${doc.s3_key}`;\n                    const result = analyzeResults[doc.id];\n                    const isAnalyzing = analyzingId === doc.id;\n\n                    return (\n                        <div key={doc.id} className=\"bg-white shadow rounded-lg p-4 flex flex-col\">\n                            <p className=\"font-medium text-gray-900\">{doc.file_name}</p>\n                            <a\n                                href={s3Url}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"mt-2 text-blue-600 hover:underline\"\n                            >\n                                열기\n                            </a>\n\n                            <button\n                                onClick={() => handleAnalyze(doc)}\n                                disabled={isAnalyzing}\n                                className={`mt-2 px-3 py-1 rounded text-white ${\n                                    isAnalyzing ? \"bg-gray-400 cursor-not-allowed\" : \"bg-green-500 hover:bg-green-600\"\n                                }`}\n                            >\n                                {isAnalyzing ? \"분석 중...\" : \"분석\"}\n                            </button>\n\n                            <p className=\"mt-auto text-gray-500 text-sm\">Uploader ID: {doc.uploader_id}</p>\n\n                            {result && (\n                                <div className=\"mt-4 bg-gray-50 border border-gray-300 p-3 rounded shadow-inner text-gray-800\">\n                                    <h3 className=\"font-semibold mb-1 text-gray-900\">Parsed Text</h3>\n                                    <pre className=\"whitespace-pre-wrap text-sm\">{result.parsed_text}</pre>\n\n                                    <h3 className=\"font-semibold mt-3 mb-1 text-gray-900\">Summaries</h3>\n                                    <ul className=\"list-disc list-inside text-sm\">\n                                        <li><strong>Bullet:</strong> {result.summaries.bullet}</li>\n                                        <li><strong>Abstract:</strong> {result.summaries.abstract}</li>\n                                        <li><strong>Casual:</strong> {result.summaries.casual}</li>\n                                        <li><strong>Final:</strong> {result.summaries.final}</li>\n                                    </ul>\n\n                                    <h3 className=\"font-semibold mt-3 mb-1 text-gray-900\">Answer</h3>\n                                    <p className=\"text-sm\">{result.answer}</p>\n                                </div>\n                            )}\n                        </div>\n                    );\n                })}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}